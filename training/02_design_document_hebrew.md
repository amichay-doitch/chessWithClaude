# מסמך דיזיין - מנוע שחמט מבוסס למידה

## 1. סקירה כללית
[תיאור קצר של המטרה והגישה]

---

## 2. נתונים (Data)

### 2.1 מבנה הנתונים
[מה כל רשומה מכילה]

### 2.2 איסוף נתונים
[איך נייצר משחקים]

### 2.3 כמות נתונים
[כמה משחקים צריך, מתי נייצר עוד]

---

## 3. פיצ'רים (Feature Engineering)

### 3.1 פיצ'רי חומר
- ספירת כלים לפי סוג (רגלי, פרש, רץ, צריח, מלכה) לכל צד
- יתרון חומר כולל
- **טבלאות כלי-משבצת (PSQT)** - ערך הכלי תלוי במיקום (פרש במרכז > בפינה, צריח על טור פתוח, וכו')
- חוסר איזון חומרי (זוג רצים מול פרש+רגלים, מלכה מול 2 צריחים, וכו')

### 3.2 מבנה רגלים
- רגלים כפולים (שני רגלים על אותו טור)
- רגלים מבודדים (אין רגלים ידידותיים בטורים סמוכים)
- רגלים מקושרים (רגלים שמגנים זה על זה)
- רגלים עוברים (אין רגלי יריב חוסמים או תוקפים)
- **רגלים אחוריים** - רגלים שמאחורי אחרים ולא יכולים להתקדם בבטחה (חולשה סטטית)
- **איי רגלים** - מספר קבוצות רגלים מנותקות (פחות = מבנה חזק יותר)
- פוטנציאל הכתרה (מרחק לשורה 8)
- **חוק הריבוע** - האם המלך יכול לתפוס רגלי עובר? (סיום)

### 3.3 פעילות כלים
- שליטה במרכז (משבצות מרכזיות מאוימות)
- ניידות כלים (מהלכים חוקיים לכל כלי)
- עמדות מבוצרות (כלים על משבצות שלא יכולים להיות מאוימים ע"י רגלי יריב)
- כלים נעוצים (לא יכולים לזוז מבלי לחשוף כלי יקר יותר)
- **צריחים מקושרים** (צריחים שמגנים זה על זה על אותה שורה/טור)
- **רץ על אלכסון ארוך** - שליטה באלכסונים מרכזיים
- **רץ בפיאנקטו** - רץ שפותח ל-b2/g2/b7/g7
- פרשים/רצים במרכז מול בפינות
- כלים שיצאו מהשורה האחורית
- **פעילות מלכה** - ממורכזת מול בקצה

### 3.4 בטיחות המלך
- זכויות הצרחה (עדיין יכול להצריח קצר/ארוך)
- מיקום המלך (מוגן בפינה מול חשוף במרכז)
- כלים שמגנים על אזור המלך
- כלי יריב שתוקפים את אזור המלך
- **מגן רגלים** - רגלים מול מלך שהצריח (כמה, מבנה)
- **סערת רגלים** - רגלי יריב מתקדמים לכיוון המלך
- **טורים/אלכסונים פתוחים לכיוון המלך** - וקטורי תקיפה
- **משבצות בריחה למלך** - משבצות בטוחות למלך לברוח

### 3.5 שלב המשחק
- פתיחה / אמצע משחק / סיום (לפי כמות חומר)
- מספר המהלך
- **פעילות המלך** (בסיום, מלך פעיל קריטי)
- **אופוזיציה** - מיקומי מלכים בסיומי רגלים

### 3.6 איומים והתקפות
- בשח?
- כלים תחת איום
- כלים שתוקפים כלי יריב
- **טמפו / יוזמה** - מי תוקף, מי מתגונן

### 3.7 טקטיקות
- מזלגות (כלי שתוקף 2+ כלי יריב)
- שיפודים (תקיפה דרך כלי יקר לכלי מאחוריו)
- התקפות גילוי (הזזת כלי חושפת התקפה מכלי אחר)
- שח כפול (שני כלים נותנים שח)
- כלים לכודים (אין משבצות בריחה בטוחות)
- כלים תלויים (לא מוגנים, אפשר לאכול בחינם)
- התקפות רנטגן (התקפות דרך כלים לאורך קווים)
- **התקפות סוללה** - שני צריחים על אותו טור, או מלכה+צריח, מלכה+רץ על אלכסון
- **כלים עמוסים** - כלי שמגן על יותר מדי דברים

### 3.8 פיצ'רים אסטרטגיים

**למודל 1 (למידה קלאסית) - פיצ'רים ברורים וניתנים לספירה:**
- עמדה פתוחה מול סגורה (מספר טורים פתוחים/חצי-פתוחים)
- יתרון זוג רצים
- צריח על טור פתוח / שורה 7
- יתרון מרחב (משבצות נשלטות מעבר לשורה 4)
- רוב רגלים (בצד המלך/המלכה)
- שליטה בטורים פתוחים/חצי-פתוחים
- **שליטה בקומפלקס צבע** - שליטה במשבצות בהירות/כהות

**למודל 2 (רשת נוירונים) - דפוסים ניואנסיים יותר:**
- רץ טוב מול רץ רע (רגלים חוסמים את צבע הרץ)
- תיאום כלים (כלים שתומכים זה בזה)
- משבצות חלשות (לא ניתנות להגנה ע"י רגלים)
- חסימה (כלי שחוסם רגלי עובר)
- פרש מול רץ (מה עדיף בעמדה הנוכחית)

*הערה: רשת נוירונים יכולה ללמוד דפוסים עדינים מייצוג הלוח הגולמי. למידה קלאסית דורשת הנדסת פיצ'רים מפורשת.*

### 3.9 פיצ'רים דינמיים
- ספירת חזרות (מתקרבים לתיקו?)
- מונה 50 מהלכים
- המהלך האחרון היה אכילה/שח? (מומנטום)
- מי לזוז (טמפו)

### 3.10 ייצוג הלוח

**למודל 1 (למידה קלאסית):**
- וקטור פיצ'רים של כל הנ"ל (חלק בינאריים, חלק מספריים)
- סה"כ ~50-100 פיצ'רים

**למודל 2 (רשת נוירונים):**
- מישורי קלט כמו AlphaZero (8x8x12 ערוצים לכלים)
- היסטוריית עמדות (לזיהוי חזרות)
- **פיצ'רי HalfKP** (מיקום מלך + מיקומי כלים יחסית למלך) - בשימוש ב-Stockfish NNUE

---

## 4. מודל 1 - למידה קלאסית

### 4.1 ארכיטקטורה
[אלגוריתם - עצי החלטה? gradient boosting?]

### 4.2 Policy (בחירת מהלך)
[איך המודל בוחר מהלך]

### 4.3 Value (הערכת פוזיציה)
[איך המודל מעריך פוזיציה]

### 4.4 אימון
[תהליך האימון]

---

## 5. מודל 2 - רשת נוירונים

### 5.1 ארכיטקטורה
[מבנה הרשת]

### 5.2 רשת Policy
[רשת לבחירת מהלך]

### 5.3 רשת Value
[רשת להערכת פוזיציה]

### 5.4 אימון
[תהליך האימון]

---

## 6. למידת חיזוק (Reinforcement Learning)

### 6.1 אלגוריתם
[איזה אלגוריתם RL]

### 6.2 תגמול (Reward)
[מה התגמול - רק ניצחון? גם ביניים?]

### 6.3 משחק עצמי (Self-play)
[איך המודל משחק נגד עצמו]

### 6.4 לולאת האימון
[תהליך מלא של איטרציה]

---

## 7. אינטגרציה עם המערכת

### 7.1 ממשק Engine
[איך המנוע החדש משתלב ב-engine pool]

### 7.2 שמירת מודלים
[איך שומרים וטוענים מודלים]

---

## 8. הערכה ומדידה

### 8.1 מדדים
[איך נמדוד הצלחה]

### 8.2 טורנירים
[משחקים נגד מנועים אחרים]

---

## 9. שלבי פיתוח

### שלב 1: [תיאור]
### שלב 2: [תיאור]
### שלב 3: [תיאור]

---

## 10. שאלות פתוחות
[דברים שצריך להחליט]
